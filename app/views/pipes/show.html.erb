<% content_for :javascript do %>


<script>

window.boxes = {

    containers: [
    <% if @pipe.root %>
      {xtype: jsBox, position: [500, 250], close: false, codeText: 'Repositories', has_pipe: false, ddHandleClassName: 'WireIt-Container-ddhandle-last' },
      <% end %>
      <% @pipe.nodes.each_with_index do |node, index| %>
        <% has_pipe = node.has_pipe.blank? ? false : "'#{node.has_pipe}'" %>
        
        <%= "{xtype: #{node.kind}, id: #{node.id}, position: [#{node.x}, #{node.y}], 
        codeText: '#{node.content}' + ' ' + #{node.id}, has_pipe: #{has_pipe} }"%>,
      <% end %>
      
      {xtype: repositoryBox, position: [500, 600], close: false, codeText: 'Last', has_pipe: false, ddHandleClassName: 'WireIt-Container-ddhandle-last' }
      
    ],
    
    wires: [
    <% @pipe.edges.each_with_index do |edge, index| %>    
      <%= "{src: {moduleId: #{edge.from_node}, terminalId: #{edge.from_terminal}}, tgt: {moduleId: #{edge.to_node}, terminalId: #{edge.to_terminal}}}" %> <% if index < @pipe.edges.size - 1 %>,<% end %>        
    <% end %>
    ]
    
 }
</script>

<% end %>
